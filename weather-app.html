<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skye â€” Weather</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & ROOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --transition: 1.2s cubic-bezier(0.4, 0, 0.2, 1);
  --card-blur: blur(24px);
  --white: #ffffff;
  --glass: rgba(255,255,255,0.12);
  --glass-border: rgba(255,255,255,0.22);
  --glass-hover: rgba(255,255,255,0.18);
  --text-primary: rgba(255,255,255,0.96);
  --text-secondary: rgba(255,255,255,0.62);
  --text-dim: rgba(255,255,255,0.38);
  --shadow: 0 32px 80px rgba(0,0,0,0.3), 0 8px 24px rgba(0,0,0,0.2);
  --shadow-sm: 0 4px 16px rgba(0,0,0,0.2);
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Outfit', sans-serif;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  overflow: hidden;
  position: relative;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED BACKGROUNDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bg-layer {
  position: fixed;
  inset: 0;
  z-index: 0;
  transition: opacity var(--transition);
  opacity: 0;
}
.bg-layer.active { opacity: 1; }

/* Sunny â€” warm golden gradient */
#bg-sunny {
  background: linear-gradient(160deg, #f7931e 0%, #f9a825 20%, #ffb74d 45%, #ff8f00 70%, #e65100 100%);
}
#bg-sunny::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 60% 50% at 70% 20%, rgba(255,255,200,0.35) 0%, transparent 65%),
              radial-gradient(ellipse 40% 40% at 30% 80%, rgba(255,140,0,0.3) 0%, transparent 60%);
}

/* Cloudy â€” cool grey-blue */
#bg-cloudy {
  background: linear-gradient(160deg, #546e7a 0%, #607d8b 25%, #78909c 55%, #90a4ae 80%, #b0bec5 100%);
}
#bg-cloudy::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 70% 40% at 50% 10%, rgba(255,255,255,0.15) 0%, transparent 60%);
}

/* Rainy â€” deep moody blue */
#bg-rainy {
  background: linear-gradient(160deg, #0d1b2a 0%, #1b2d42 25%, #1e3a5f 55%, #1a3a5c 80%, #0d2137 100%);
}
#bg-rainy::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 50% 60% at 20% 30%, rgba(30,100,160,0.4) 0%, transparent 60%),
              radial-gradient(ellipse 40% 40% at 80% 70%, rgba(10,50,100,0.5) 0%, transparent 60%);
}

/* Snowy â€” crisp icy white-blue */
#bg-snowy {
  background: linear-gradient(160deg, #b3c8e8 0%, #cfe0f3 25%, #e8f4ff 55%, #daeaf7 80%, #c5daf0 100%);
}
#bg-snowy::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 60% 50% at 50% 0%, rgba(255,255,255,0.6) 0%, transparent 60%);
}

/* Night â€” deep purple-navy */
#bg-night {
  background: linear-gradient(160deg, #0a0a1a 0%, #0d1020 25%, #141830 55%, #1a1f3a 80%, #0f1225 100%);
}
#bg-night::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 40% 40% at 80% 15%, rgba(100,80,200,0.25) 0%, transparent 60%),
              radial-gradient(ellipse 30% 30% at 20% 70%, rgba(50,60,160,0.2) 0%, transparent 60%);
}

/* Thunderstorm */
#bg-storm {
  background: linear-gradient(160deg, #0a0a0f 0%, #12121e 25%, #1a1530 55%, #100f1f 80%, #0a080f 100%);
}
#bg-storm::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse 50% 40% at 50% 20%, rgba(80,50,180,0.3) 0%, transparent 60%);
}

/* Mist / Fog */
#bg-mist {
  background: linear-gradient(160deg, #78909c 0%, #90a4ae 25%, #a8bfc8 55%, #b8cdd4 80%, #9eb6bf 100%);
}

/* Default / initial */
#bg-default {
  background: linear-gradient(160deg, #1a1a2e 0%, #16213e 30%, #0f3460 65%, #1a2550 100%);
}
#bg-default.active { opacity: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATED WEATHER PARTICLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.particles {
  position: fixed;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  overflow: hidden;
}

/* Rain drops */
.raindrop {
  position: absolute;
  top: -10px;
  width: 1.5px;
  border-radius: 10px;
  background: linear-gradient(180deg, transparent, rgba(180,220,255,0.7));
  animation: rain linear infinite;
}
@keyframes rain {
  to { transform: translateY(110vh) translateX(40px); opacity: 0; }
}

/* Snow flakes */
.snowflake {
  position: absolute;
  top: -20px;
  border-radius: 50%;
  background: rgba(255,255,255,0.85);
  animation: snowfall linear infinite;
  filter: blur(0.5px);
}
@keyframes snowfall {
  to { transform: translateY(110vh) translateX(var(--drift)); opacity: 0; }
}

/* Sun rays */
.sunray {
  position: absolute;
  top: -80px;
  left: 50%;
  transform-origin: bottom center;
  width: 3px;
  height: 200px;
  background: linear-gradient(180deg, rgba(255,230,100,0.6) 0%, transparent 100%);
  animation: rotate-rays 8s linear infinite;
  border-radius: 2px;
}
@keyframes rotate-rays {
  from { transform: translateX(-50%) rotate(0deg); }
  to   { transform: translateX(-50%) rotate(360deg); }
}

/* Stars */
.star {
  position: absolute;
  border-radius: 50%;
  background: white;
  animation: twinkle ease-in-out infinite;
}
@keyframes twinkle {
  0%, 100% { opacity: 0.2; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.4); }
}

/* Clouds drifting */
.driftcloud {
  position: absolute;
  background: rgba(255,255,255,0.15);
  border-radius: 50px;
  filter: blur(8px);
  animation: driftcloud linear infinite;
}
@keyframes driftcloud {
  from { transform: translateX(-300px); }
  to   { transform: translateX(calc(100vw + 300px)); }
}

/* Lightning */
@keyframes lightning-flash {
  0%, 90%, 100% { opacity: 0; }
  92%, 96% { opacity: 0.6; }
  94%, 98% { opacity: 0.1; }
}
.lightning-overlay {
  position: fixed;
  inset: 0;
  background: rgba(180,160,255,0.4);
  pointer-events: none;
  z-index: 2;
  opacity: 0;
  animation: lightning-flash 4s ease-in-out infinite;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN APP CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app {
  position: relative;
  z-index: 10;
  width: 100%;
  max-width: 440px;
}

.card {
  background: var(--glass);
  backdrop-filter: var(--card-blur);
  -webkit-backdrop-filter: var(--card-blur);
  border: 1px solid var(--glass-border);
  border-radius: 32px;
  padding: 36px 32px 32px;
  box-shadow: var(--shadow);
  transition: all 0.6s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 28px;
}

.app-name {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--text-secondary);
}

.time-display {
  font-size: 13px;
  font-weight: 400;
  color: var(--text-secondary);
  font-variant-numeric: tabular-nums;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH BAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.search-wrap {
  position: relative;
  margin-bottom: 32px;
}

.search-input {
  width: 100%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  border-radius: 16px;
  padding: 16px 52px 16px 20px;
  font-family: 'Outfit', sans-serif;
  font-size: 15px;
  font-weight: 400;
  color: var(--text-primary);
  outline: none;
  transition: all 0.3s ease;
  -webkit-appearance: none;
}

.search-input::placeholder { color: var(--text-dim); }

.search-input:focus {
  background: rgba(255,255,255,0.16);
  border-color: rgba(255,255,255,0.4);
  box-shadow: 0 0 0 3px rgba(255,255,255,0.08);
}

.search-btn {
  position: absolute;
  right: 8px; top: 50%;
  transform: translateY(-50%);
  width: 38px; height: 38px;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.25);
  border-radius: 10px;
  color: var(--text-primary);
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.25s;
  font-size: 16px;
}
.search-btn:hover {
  background: rgba(255,255,255,0.28);
  transform: translateY(-50%) scale(1.05);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATES: LOADING / ERROR / EMPTY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.state-view {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
  gap: 16px;
  text-align: center;
}
.state-view.visible { display: flex; }

/* Spinner */
.spinner {
  width: 48px; height: 48px;
  border: 3px solid rgba(255,255,255,0.15);
  border-top-color: rgba(255,255,255,0.8);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text { font-size: 14px; color: var(--text-secondary); font-weight: 300; }

/* Error */
.error-icon { font-size: 44px; animation: shake 0.5s ease; }
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-8px); }
  40%, 80% { transform: translateX(8px); }
}
.error-title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
.error-msg   { font-size: 14px; color: var(--text-secondary); font-weight: 300; }

/* Empty / welcome state */
.empty-icon { font-size: 56px; opacity: 0.5; }
.empty-text { font-size: 15px; color: var(--text-secondary); font-weight: 300; line-height: 1.6; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEATHER DISPLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#weather-display {
  display: none;
  animation: fadeInUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}
#weather-display.visible { display: block; }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(24px) scale(0.97); }
  to   { opacity: 1; transform: translateY(0) scale(1); }
}

/* Location row */
.location-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}
.location-pin { font-size: 15px; opacity: 0.7; }
.city-name {
  font-size: 17px;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: 0.02em;
}
.country-code {
  font-size: 13px;
  font-weight: 400;
  color: var(--text-secondary);
  background: rgba(255,255,255,0.12);
  padding: 2px 8px;
  border-radius: 20px;
  margin-left: auto;
}

.local-time {
  font-size: 12px;
  color: var(--text-dim);
  margin-bottom: 28px;
  font-weight: 300;
}

/* Main weather display â€” icon + temp */
.weather-main {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.weather-icon-wrap {
  position: relative;
  width: 110px; height: 110px;
  display: flex; align-items: center; justify-content: center;
}

.weather-icon {
  font-size: 86px;
  line-height: 1;
  filter: drop-shadow(0 4px 20px rgba(0,0,0,0.3));
  animation: iconFloat 4s ease-in-out infinite;
  display: block;
  text-align: center;
}
@keyframes iconFloat {
  0%, 100% { transform: translateY(0px) rotate(-2deg); }
  50%       { transform: translateY(-10px) rotate(2deg); }
}

.temp-wrap {}
.temperature {
  font-size: 80px;
  font-weight: 200;
  line-height: 1;
  color: var(--text-primary);
  letter-spacing: -4px;
  text-align: right;
}
.temperature .unit {
  font-size: 36px;
  font-weight: 300;
  vertical-align: super;
  letter-spacing: 0;
  margin-left: 2px;
}
.feels-like {
  font-size: 13px;
  color: var(--text-secondary);
  text-align: right;
  font-weight: 300;
  margin-top: 4px;
}

/* Condition badge */
.condition-wrap {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 28px;
}
.condition-badge {
  display: inline-block;
  background: rgba(255,255,255,0.14);
  border: 1px solid rgba(255,255,255,0.2);
  padding: 6px 16px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-primary);
  letter-spacing: 0.03em;
}
.hi-lo {
  font-size: 13px;
  color: var(--text-secondary);
  font-weight: 300;
  margin-left: auto;
}

/* Stats grid */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 10px;
  margin-bottom: 20px;
}

.stat-card {
  background: rgba(255,255,255,0.09);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 18px;
  padding: 16px 12px;
  text-align: center;
  transition: background 0.25s;
}
.stat-card:hover { background: rgba(255,255,255,0.14); }

.stat-icon { font-size: 20px; margin-bottom: 8px; display: block; }
.stat-value {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-primary);
  display: block;
  margin-bottom: 3px;
}
.stat-label {
  font-size: 11px;
  font-weight: 400;
  color: var(--text-dim);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}

/* Bottom info row */
.bottom-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 16px;
  border-top: 1px solid rgba(255,255,255,0.1);
}
.sunrise-set {
  display: flex; gap: 16px;
}
.sun-item {
  display: flex; align-items: center; gap: 5px;
  font-size: 12px; color: var(--text-secondary); font-weight: 300;
}
.sun-item span { font-weight: 500; color: var(--text-primary); }

.uv-wrap {
  display: flex; align-items: center; gap: 6px;
}
.uv-label {
  font-size: 11px; color: var(--text-dim);
  text-transform: uppercase; letter-spacing: 0.08em;
}
.uv-badge {
  font-size: 12px; font-weight: 600;
  padding: 3px 10px; border-radius: 10px;
  background: rgba(255,255,255,0.15);
  color: var(--text-primary);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 480px) {
  .card { padding: 28px 22px 24px; border-radius: 28px; }
  .temperature { font-size: 68px; }
  .weather-icon { font-size: 72px; }
}

</style>
</head>
<body>

<!-- â•â•â• BACKGROUND LAYERS â•â•â• -->
<div class="bg-layer active" id="bg-default"></div>
<div class="bg-layer" id="bg-sunny"></div>
<div class="bg-layer" id="bg-cloudy"></div>
<div class="bg-layer" id="bg-rainy"></div>
<div class="bg-layer" id="bg-snowy"></div>
<div class="bg-layer" id="bg-night"></div>
<div class="bg-layer" id="bg-storm"></div>
<div class="bg-layer" id="bg-mist"></div>

<!-- Particles container -->
<div class="particles" id="particles"></div>

<!-- â•â•â• MAIN APP â•â•â• -->
<div class="app">
  <div class="card">

    <!-- Header -->
    <div class="app-header">
      <div class="app-name">â˜ Skye</div>
      <div class="time-display" id="clock">--:--</div>
    </div>

    <!-- Search -->
    <div class="search-wrap">
      <input
        type="text"
        class="search-input"
        id="search-input"
        placeholder="Search city... e.g. Stuttgart"
        autocomplete="off"
        spellcheck="false"
      >
      <button class="search-btn" id="search-btn" title="Search">
        &#8599;
      </button>
    </div>

    <!-- Loading state -->
    <div class="state-view" id="state-loading">
      <div class="spinner"></div>
      <div class="loading-text">Fetching weather dataâ€¦</div>
    </div>

    <!-- Error state -->
    <div class="state-view" id="state-error">
      <div class="error-icon">ğŸŒ§</div>
      <div class="error-title">City not found</div>
      <div class="error-msg" id="error-msg">Please check the spelling and try again.</div>
    </div>

    <!-- Empty / welcome state -->
    <div class="state-view visible" id="state-empty">
      <div class="empty-icon">ğŸŒ</div>
      <div class="empty-text">Type a city name above<br>to get live weather</div>
    </div>

    <!-- Weather Result -->
    <div id="weather-display">

      <!-- Location -->
      <div class="location-row">
        <span class="location-pin">ğŸ“</span>
        <span class="city-name" id="wd-city">â€“</span>
        <span class="country-code" id="wd-country">â€“</span>
      </div>
      <div class="local-time" id="wd-localtime">â€“</div>

      <!-- Icon + Temperature -->
      <div class="weather-main">
        <div class="weather-icon-wrap">
          <span class="weather-icon" id="wd-icon">â˜€ï¸</span>
        </div>
        <div class="temp-wrap">
          <div class="temperature">
            <span id="wd-temp">â€“</span><span class="unit">Â°</span>
          </div>
          <div class="feels-like">Feels like <span id="wd-feels">â€“</span>Â°C</div>
        </div>
      </div>

      <!-- Condition -->
      <div class="condition-wrap">
        <span class="condition-badge" id="wd-condition">â€“</span>
        <span class="hi-lo">
          â†‘ <span id="wd-max">â€“</span>Â° &nbsp; â†“ <span id="wd-min">â€“</span>Â°
        </span>
      </div>

      <!-- Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">ğŸ’§</span>
          <span class="stat-value" id="wd-humidity">â€“</span>
          <span class="stat-label">Humidity</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">ğŸŒ¬</span>
          <span class="stat-value" id="wd-wind">â€“</span>
          <span class="stat-label">Wind</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">ğŸ‘</span>
          <span class="stat-value" id="wd-visibility">â€“</span>
          <span class="stat-label">Visibility</span>
        </div>
      </div>

      <!-- Bottom row -->
      <div class="bottom-row">
        <div class="sunrise-set">
          <div class="sun-item">ğŸŒ… <span id="wd-sunrise">â€“</span></div>
          <div class="sun-item">ğŸŒ‡ <span id="wd-sunset">â€“</span></div>
        </div>
        <div class="uv-wrap">
          <span class="uv-label">Pressure</span>
          <span class="uv-badge" id="wd-pressure">â€“</span>
        </div>
      </div>

    </div><!-- /weather-display -->

  </div><!-- /card -->
</div><!-- /app -->

<script>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG â€” Replace with your real API key
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const API_KEY = 'e2fbfa27a4afa63cc9178fd6dcd027c9';
const API_URL = 'https://api.openweathermap.org/data/2.5/weather';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOM REFERENCES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const searchInput = document.getElementById('search-input');
const searchBtn   = document.getElementById('search-btn');
const stateLoading = document.getElementById('state-loading');
const stateError   = document.getElementById('state-error');
const stateEmpty   = document.getElementById('state-empty');
const weatherDisplay = document.getElementById('weather-display');
const errorMsg     = document.getElementById('error-msg');

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE CLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2, '0');
  const m = String(now.getMinutes()).padStart(2, '0');
  document.getElementById('clock').textContent = `${h}:${m}`;
}
updateClock();
setInterval(updateClock, 30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEATHER ICON MAPPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getWeatherIcon(weatherId, isNight) {
  if (weatherId >= 200 && weatherId < 300) return 'â›ˆ';           // Thunderstorm
  if (weatherId >= 300 && weatherId < 400) return 'ğŸŒ¦';           // Drizzle
  if (weatherId >= 500 && weatherId < 600) {
    if (weatherId === 511) return 'ğŸŒ¨';                             // Freezing rain
    return weatherId >= 502 ? 'ğŸŒ§' : 'ğŸŒ¦';                         // Heavy / light rain
  }
  if (weatherId >= 600 && weatherId < 700) return 'â„ï¸';            // Snow
  if (weatherId >= 700 && weatherId < 800) return 'ğŸŒ«';            // Atmosphere (fog/mist)
  if (weatherId === 800) return isNight ? 'ğŸŒ™' : 'â˜€ï¸';             // Clear
  if (weatherId === 801) return isNight ? 'ğŸŒ™' : 'ğŸŒ¤';             // Few clouds
  if (weatherId === 802) return 'â›…';                               // Scattered clouds
  if (weatherId >= 803) return 'â˜ï¸';                               // Broken/overcast clouds
  return 'ğŸŒ¡';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND THEME MAPPER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getTheme(weatherId, isNight) {
  if (isNight)                              return 'night';
  if (weatherId >= 200 && weatherId < 300) return 'storm';
  if (weatherId >= 300 && weatherId < 600) return 'rainy';
  if (weatherId >= 600 && weatherId < 700) return 'snowy';
  if (weatherId >= 700 && weatherId < 800) return 'mist';
  if (weatherId === 800)                   return 'sunny';
  if (weatherId <= 802)                    return 'sunny';
  return 'cloudy';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARTICLE SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const particlesEl = document.getElementById('particles');
let particleInterval = null;

function clearParticles() {
  if (particleInterval) clearInterval(particleInterval);
  particlesEl.innerHTML = '';
}

function spawnRain() {
  clearParticles();
  function createDrop() {
    const drop = document.createElement('div');
    drop.className = 'raindrop';
    const x = Math.random() * 110 - 10;
    const dur = 0.5 + Math.random() * 0.6;
    const ht = 12 + Math.random() * 18;
    drop.style.cssText = `left:${x}vw;height:${ht}px;animation-duration:${dur}s;animation-delay:${Math.random() * 2}s;opacity:${0.4 + Math.random() * 0.4}`;
    particlesEl.appendChild(drop);
    setTimeout(() => drop.remove(), (dur + 0.5) * 1000);
  }
  for (let i = 0; i < 40; i++) createDrop();
  particleInterval = setInterval(() => { for(let i=0;i<4;i++) createDrop(); }, 150);
}

function spawnSnow() {
  clearParticles();
  function createFlake() {
    const flake = document.createElement('div');
    flake.className = 'snowflake';
    const x = Math.random() * 105;
    const size = 3 + Math.random() * 5;
    const dur = 3 + Math.random() * 5;
    const drift = (Math.random() - 0.5) * 80;
    flake.style.cssText = `left:${x}vw;width:${size}px;height:${size}px;--drift:${drift}px;animation-duration:${dur}s;animation-delay:${Math.random() * 3}s;opacity:${0.5 + Math.random() * 0.4}`;
    particlesEl.appendChild(flake);
    setTimeout(() => flake.remove(), (dur + 1) * 1000);
  }
  for (let i = 0; i < 30; i++) createFlake();
  particleInterval = setInterval(() => createFlake(), 200);
}

function spawnSunRays() {
  clearParticles();
  for (let i = 0; i < 12; i++) {
    const ray = document.createElement('div');
    ray.className = 'sunray';
    ray.style.cssText = `transform:translateX(-50%) rotate(${i * 30}deg);animation-delay:${i * 0.1}s;opacity:0.3`;
    particlesEl.appendChild(ray);
  }
}

function spawnStars() {
  clearParticles();
  for (let i = 0; i < 80; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    const size = 1 + Math.random() * 3;
    const dur = 2 + Math.random() * 4;
    star.style.cssText = `left:${Math.random()*100}vw;top:${Math.random()*70}vh;width:${size}px;height:${size}px;animation-duration:${dur}s;animation-delay:${Math.random()*4}s`;
    particlesEl.appendChild(star);
  }
}

function spawnClouds() {
  clearParticles();
  for (let i = 0; i < 5; i++) {
    const cloud = document.createElement('div');
    cloud.className = 'driftcloud';
    const w = 150 + Math.random() * 200;
    const h = 40 + Math.random() * 50;
    const dur = 20 + Math.random() * 20;
    cloud.style.cssText = `top:${10 + Math.random() * 50}%;width:${w}px;height:${h}px;animation-duration:${dur}s;animation-delay:-${Math.random()*dur}s`;
    particlesEl.appendChild(cloud);
  }
}

function spawnLightning() {
  const flash = document.createElement('div');
  flash.className = 'lightning-overlay';
  document.body.appendChild(flash);
  setTimeout(() => flash.remove(), 10000);
}

function applyParticles(theme) {
  clearParticles();
  document.querySelectorAll('.lightning-overlay').forEach(e => e.remove());
  switch (theme) {
    case 'rainy':  spawnRain(); spawnClouds(); break;
    case 'snowy':  spawnSnow(); spawnClouds(); break;
    case 'sunny':  spawnSunRays(); break;
    case 'night':  spawnStars(); break;
    case 'storm':  spawnRain(); spawnLightning(); break;
    case 'cloudy':
    case 'mist':   spawnClouds(); break;
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BACKGROUND SWITCHER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setBackground(theme) {
  document.querySelectorAll('.bg-layer').forEach(el => el.classList.remove('active'));
  const target = document.getElementById('bg-' + theme);
  if (target) target.classList.add('active');
  applyParticles(theme);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOW / HIDE STATES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showState(state) {
  stateLoading.classList.remove('visible');
  stateError.classList.remove('visible');
  stateEmpty.classList.remove('visible');
  weatherDisplay.classList.remove('visible');
  weatherDisplay.style.display = 'none';

  if (state === 'loading') stateLoading.classList.add('visible');
  if (state === 'error')   stateError.classList.add('visible');
  if (state === 'empty')   stateEmpty.classList.add('visible');
  if (state === 'weather') {
    weatherDisplay.style.display = 'block';
    // Force reflow for animation restart
    void weatherDisplay.offsetWidth;
    weatherDisplay.classList.add('visible');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIME UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function formatTime(unixTimestamp, timezoneOffsetSeconds) {
  const utcMs = unixTimestamp * 1000;
  const localMs = utcMs + timezoneOffsetSeconds * 1000;
  const d = new Date(localMs);
  const h = String(d.getUTCHours()).padStart(2, '0');
  const m = String(d.getUTCMinutes()).padStart(2, '0');
  return `${h}:${m}`;
}

function isNightTime(unixNow, sunrise, sunset, tzOffset) {
  const localNow = unixNow + tzOffset;
  const localSunrise = sunrise + tzOffset;
  const localSunset  = sunset + tzOffset;
  return localNow < localSunrise || localNow > localSunset;
}

function getLocalDateString(unixTimestamp, tzOffset) {
  const ms = (unixTimestamp + tzOffset) * 1000;
  const d = new Date(ms);
  return d.toUTCString().slice(0, 22); // "Mon, 24 Feb 2026 14:30"
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN FETCH FUNCTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function fetchWeather(city) {
  if (!city.trim()) return;

  showState('loading');

  try {
    // â”€â”€ THE FETCH CALL â”€â”€
    const url = `${API_URL}?q=${encodeURIComponent(city)}&appid=${API_KEY}&units=metric`;
    const response = await fetch(url);

    // Check if HTTP request itself failed
    if (!response.ok) {
      if (response.status === 404) {
        errorMsg.textContent = `"${city}" was not found. Check spelling and try again.`;
      } else if (response.status === 401) {
        errorMsg.textContent = 'Invalid API key. Replace YOUR_API_KEY with your real key.';
      } else {
        errorMsg.textContent = `Something went wrong (Error ${response.status}). Try again.`;
      }
      showState('error');
      setBackground('default');
      return;
    }

    // Parse JSON response
    const data = await response.json();

    // â”€â”€ EXTRACT DATA â”€â”€
    const weatherId  = data.weather[0].id;
    const tzOffset   = data.timezone; // seconds offset from UTC
    const unixNow    = data.dt;
    const nightMode  = isNightTime(unixNow, data.sys.sunrise, data.sys.sunset, tzOffset);

    // Determine theme & icon
    const theme = getTheme(weatherId, nightMode);
    const icon  = getWeatherIcon(weatherId, nightMode);

    // â”€â”€ POPULATE UI â”€â”€
    document.getElementById('wd-city').textContent    = data.name;
    document.getElementById('wd-country').textContent = data.sys.country;
    document.getElementById('wd-localtime').textContent =
      'Local time Â· ' + getLocalDateString(unixNow, tzOffset);

    document.getElementById('wd-icon').textContent      = icon;
    document.getElementById('wd-temp').textContent      = Math.round(data.main.temp);
    document.getElementById('wd-feels').textContent     = Math.round(data.main.feels_like);
    document.getElementById('wd-condition').textContent = data.weather[0].description
      .split(' ').map(w => w[0].toUpperCase() + w.slice(1)).join(' ');
    document.getElementById('wd-max').textContent       = Math.round(data.main.temp_max);
    document.getElementById('wd-min').textContent       = Math.round(data.main.temp_min);

    document.getElementById('wd-humidity').textContent    = data.main.humidity + '%';
    document.getElementById('wd-wind').textContent        = Math.round(data.wind.speed * 3.6) + ' km/h';
    const vis = data.visibility ? (data.visibility / 1000).toFixed(1) + ' km' : 'N/A';
    document.getElementById('wd-visibility').textContent  = vis;

    document.getElementById('wd-sunrise').textContent  = formatTime(data.sys.sunrise, tzOffset);
    document.getElementById('wd-sunset').textContent   = formatTime(data.sys.sunset, tzOffset);
    document.getElementById('wd-pressure').textContent = data.main.pressure + ' hPa';

    // â”€â”€ APPLY THEME â”€â”€
    setBackground(theme);
    showState('weather');

  } catch (err) {
    // Network error (no internet, CORS, etc.)
    errorMsg.textContent = 'Network error. Check your internet connection and try again.';
    showState('error');
    setBackground('default');
    console.error('Weather fetch error:', err);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT LISTENERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
searchBtn.addEventListener('click', () => {
  fetchWeather(searchInput.value);
});

searchInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') fetchWeather(searchInput.value);
});

// Auto-focus search on load
searchInput.focus();

</script>
</body>
</html>
